- 영속 객체(엔티티 객체)란 무엇인가?
```
DB 데이터에 매핑되는 메모리상의 객체로
@Entity를 활용하는 객체이자 엔티티 매니저가 관리하며 변경을 추적하는 대상

이때 new로 객체를 생성하면 모두 영속 객체인가? 아니다
영속성 컨텍스트에 보관된 객체가 영속 객체

영속성 컨텍스트에 보관되는 객체는?
- 응용 프로그램의 엔티티 매니저에의해 저장한 객체
- 응용 프로그램의 엔티티 매니저에의해 디비로부터 불려온 객체
```
- 영속 컨텍스트
```
일종의 메모리 저장소로
Entity Manager가 관리할 엔티티 객체 보관

(엔티티 타입 / 식별자)로 일종의 맵처럼 객체를 보관
```

### 영속성 컨텍스트와 캐시
```
동일 식별자 -> 동일 객체
- 영속성 컨텍스트에 보관된 객체를 조회
- Repeatable read 효과

즉 db에서 조회해온 영속객체를 대상으로 재조회가 일어날때 db접근이 아닌 영속성 컨텍스트에 접근하여 조회
```
- <img width="901" alt="스크린샷 2022-10-08 오후 9 17 49" src="https://user-images.githubusercontent.com/62214428/194707186-219dc06e-bbf4-4bae-98df-cab5c0d3b463.png">
```
왼쪽 코드를 보면 동일 email로 조회한 first / second 객체가 있다

이때 오른쪽 쿼리를 확인해보면 실제로 첫번째 조회시에는 select 쿼리가 발생하지만
이후에는 쿼리가 발생하지 않는데 이때 영속성컨텍스트에 보관되는 영속 객체가 존재하기에 이를 조회
```

### 영속 객체 라이프사이클
- <img width="748" alt="스크린샷 2022-10-08 오후 9 22 08" src="https://user-images.githubusercontent.com/62214428/194707337-7094aae3-0e8a-4b83-8b26-a471959c5ced.png">
```
먼저 검은 점을 시작이라고하자

- 객체를 생성
- 이후 엔티티매니저에 의해 persist() => 영속상태
- 혹은 엔티티매니저에 의해 조회된 객체 => 영속상태


----------
영속상태인 객체는 detached / removed로 변경될 수 있는데

먼저 엔티티 매니저에 의해 em.remove()되는 경우 removed 상태로 변경된다
이후 commit()전까지 추적한 상태로 commit()시점에 removed 객체 삭제가 반영된다.

em.close()로 엔티티 매니저가 종료될때 기존에 영속 객체들은 detached상태가 된다.
그리고 이러한 detached 상태는 더 이상 변경 추적 대상, 즉 관리대상이 아니다.
```
